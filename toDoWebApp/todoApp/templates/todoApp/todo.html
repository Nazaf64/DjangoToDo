<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>
<body>
    <header>
        
    </header>
    <main>
        <div class="container main">
            <h1>Todo List</h1>
            <form id="todoForm" action="http://127.0.0.1:8000/todo/taskCreate/">
                <div class="row">                        
                    <div class="col-sm-9 bg-light p-3">
                        <input type="text"
                        class="form-control" 
                        id="formInput" 
                        placeholder="Add Todo"
                        >
                    </div>
                    <div class="col-3 bg-light p-3 add-button">
                        <button id="add" type="submit" class="btn btn-primary">Add</button>
                    </div>                        
                </div>
            </form>
            <hr>
            <div class="mb-3">          
                
                <ul class="list-group list-group-flush" id="task-list">
                    <!-- <li class="list-group-item">
                        An item
                        <span class="list-button">
                            <button type="button" class="btn btn-primary">Edit</button>
                            <button type="button" class="btn btn-danger">Delete</button>
                        </span>
                    </li> -->

                </ul>
            </div>
            
        </div>
          
    </main>
    <section></section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <script>
        var formInput = document.getElementById("formInput");
        var todoForm = document.getElementById("todoForm");
        var taskList = document.getElementById("task-list");
        var deleteButtons = document.getElementsByClassName("delete-btn");
        console.log(deleteButtons);
        // del_btn_length = deleteButtons.length;
        // console.log(del_btn_length);
        // console.log(deleteButtons.length);

        // for (i=0; i<deleteButtons.length; i++){
        // // deleteButtons[i].addEventListener("click", entryDelete);
        // console.log("Hello");
        // }
        
        // for (i=0;i<deleteButtons.length; i++){
        //     console.log(i);
        // }
        
        
        for (i in deleteButtons) {
            console.log(i);
        }

        deleteButtons.forEach(element => {
            console.log(element);
        });

        window.onload = loadList();
        // loadList();

        // window.onload = (event) => {
        //     formInput.value = "";
        //     console.log('The page has fully loaded');
        //     fetch('http://127.0.0.1:8000/todo/taskView/')
        //     .then(response => response.json())
        //     // .then(data => console.log(data))
        //     .then(data => {
        //         for(i=0; i<data.length; i++){
        //             //////     USING JAVASCRIPT VARIABLES AND DOM MANAGEMENT     //////
        //             // // CREATE AN <li> TAG
        //             // var li = document.createElement('li');
        //             // li.classList.add("list-group-item");
        //             // li.innerHTML = data[i].task;                   
                    
        //             // // CREATE A SPAN TAG FOR THE BUTTONS
        //             // listButtonSet = document.createElement('span');
        //             // listButtonSet.classList.add("list-button");

        //             // // CREATE AND APPEND 'EDIT' BUTTON
        //             // editButton = document.createElement('button');
        //             // editButton.classList.add("btn");
        //             // editButton.classList.add("btn-primary");
        //             // editButton.innerHTML = "Edit";
        //             // listButtonSet.appendChild(editButton);
        //             // listButtonSet.innerHTML += " ";

        //             // // CREATE AND APPEND 'DELETE' BUTTON
        //             // deleteButton = document.createElement('button');
        //             // deleteButton.classList.add("btn");
        //             // deleteButton.classList.add("btn-danger");
        //             // deleteButton.innerHTML = "Delete";
        //             // listButtonSet.appendChild(deleteButton);

        //             // // APPEND <span> TAG TO LI ITEM
        //             // li.appendChild(listButtonSet);

        //             // // APPEND THE <li> TAG TO THE LIST
        //             // taskList.appendChild(li);  
                    
                    





        //             /////     USING TEMPLATE LITERALS     /////
        //             var li = `
        //             <li class="list-group-item">
        //                 ${data[i].task}
        //                 <span class="list-button">
        //                     <button type="button" class="btn btn-primary">Edit</button>
        //                     <button type="button" class="btn btn-danger">Delete</button>
        //                 </span>
        //             </li>
        //             `;
        //             taskList.innerHTML += li;
        //         }
        //     })
        //     .catch((error) => {
        //         console.error('Error:', error)
        //     })

        // };


        /////     LOAD TODO LIST     /////
        function loadList(){
            formInput.value = "";
            console.log('The page has fully loaded');
            fetch('http://127.0.0.1:8000/todo/taskView/')
            .then(response => response.json())
            .then(data => {
                for(i=0; i<data.length; i++){
                    var li = `
                    <li class="list-group-item">
                        <span class="task-item">${data[i].task}</span>
                        <span class="list-button">
                            <button type="button" class="btn btn-primary">Edit</button>
                            <button type="button" id="${data[i].id}" class="btn btn-danger delete-btn">Delete</button>
                        </span>
                    </li>
                    `;
                    taskList.innerHTML += li;
                    // console.log(data[i].id)
                }
            })
            .catch((error) => {
                console.error('Error:', error)
            })
        }

        /////     FORM SUBMISSION     /////
        function formSubmit(e) {
            e.preventDefault();
            console.log("form submitted");
            data = {}
            data["task"] = formInput.value;

            fetch('http://127.0.0.1:8000/todo/taskCreate/', {
            method: 'POST',
            headers: {
                'Content-type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(response => {
            var li = `
                <li class="list-group-item">
                    ${data["task"]}
                    <span class="list-button">
                        <button type="button" class="btn btn-primary">Edit</button>
                        <button type="button" class="btn btn-danger">Delete</button>
                    </span>
                </li>
                `;
            taskList.innerHTML += li;
            console.log("Data sending successful");
        })
        .catch((error) => {
                console.error('Error:', error)
            })
        formInput.value = "";
    }

    /////     ENTRY DELETION     /////
    function entryDelete(event){
        // var entry = event.target.innerHTML;
        console.log(event.target);
        console.log("Delete Button Clicked");
    }

    todoForm.addEventListener("submit", formSubmit);

    for (i=0; i<deleteButtons.length; i++){
        // deleteButtons[i].addEventListener("click", entryDelete);
        console.log("Hello");
    }
    

    </script>
</body>
</html>